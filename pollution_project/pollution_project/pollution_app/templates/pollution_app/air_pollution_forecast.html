{% extends 'pollution_app/base.html' %}

{% block title %}大气污染预测 - 预报预警 - 气象污染预测系统{% endblock %}

{% block content %}
<div class="container mt-4">
    <div class="row">
        <!-- 左侧子项导航 -->
        <div class="col-md-3 mb-4">
            <div class="card">
                <div class="card-header bg-primary text-white">
                    <h5 class="mb-0">预报预警</h5>
                </div>
                <ul class="list-group list-group-flush">
                    <li class="list-group-item">
                        <a href="{% url 'air_pollution_forecast' %}" class="text-decoration-none active fw-bold">大气污染预测</a>
                    </li>
                    <li class="list-group-item">
                        <a href="{% url 'prediction_evaluation' %}" class="text-decoration-none">预测结果评估</a>
                    </li>
                </ul>
            </div>
        </div>

        <!-- 右侧内容区域 -->
        <div class="col-md-9">
            <!-- 大气污染预测部分 -->
            <div id="air-pollution-forecast" class="card mb-4">
                <div class="card-header">
                    <h5>大气污染预测</h5>
                </div>
                <div class="card-body">
                    <!-- 模型选择标签页 -->
                    <ul class="nav nav-tabs mb-4" id="modelTabs" role="tablist">
                        <li class="nav-item" role="presentation">
                            <button class="nav-link active" id="model1-tab" data-bs-toggle="tab"
                                    data-bs-target="#model1-content" type="button" role="tab"
                                    aria-controls="model1-content" aria-selected="true">
                                模型一 (线性回归)
                            </button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="model2-tab" data-bs-toggle="tab"
                                    data-bs-target="#model2-content" type="button" role="tab"
                                    aria-controls="model2-content" aria-selected="false">
                                模型二 (神经网络)
                            </button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="model3-tab" data-bs-toggle="tab"
                                    data-bs-target="#model3-content" type="button" role="tab"
                                    aria-controls="model3-content" aria-selected="false">
                                模型三 (后端随机森林)
                            </button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="model4-tab" data-bs-toggle="tab"
                                    data-bs-target="#model4-content" type="button" role="tab"
                                    aria-controls="model4-content" aria-selected="false">
                                模型四 (综合模型)
                            </button>
                        </li>
                    </ul>

                    <!-- 标签页内容 -->
                    <div class="tab-content" id="modelTabsContent">
                        <!-- 模型一内容 -->
                        <div class="tab-pane fade show active" id="model1-content" role="tabpanel" aria-labelledby="model1-tab">
                            <!-- 加载状态覆盖层 -->
                            <div class="loading-overlay" id="forecastChartLoader1">
                                <div class="spinner"></div>
                            </div>

                            <!-- 预测图表 -->
                            <div class="chart-container" style="height: 400px;">
                                <canvas id="forecastChart1"></canvas>
                            </div>

                            <!-- 预测数据表格 -->
                            <div class="table-responsive mt-4">
                                <table class="table table-striped">
                                    <thead>
                                        <tr>
                                            <th>预测日期</th>
                                            <th>PM2.5 预测值 <span class="info-icon" data-pollutant="pm25">i</span></th>
                                            <th>PM10 预测值 <span class="info-icon" data-pollutant="pm10">i</span></th>
                                            <th>NO₂ 预测值 <span class="info-icon" data-pollutant="no2">i</span></th>
                                            <th>SO₂ 预测值 <span class="info-icon" data-pollutant="so2">i</span></th>
                                            <th>O₃ 预测值 <span class="info-icon" data-pollutant="o3">i</span></th>
                                            <th>CO 预测值 <span class="info-icon" data-pollutant="co">i</span></th>
                                            <th>综合AQI</th>
                                            <th>主要污染物</th>
                                            <th>污染等级</th>
                                        </tr>
                                    </thead>
                                    <tbody id="forecastTableBody1">
                                        <!-- 后端渲染模型一数据 -->
                                        {% for pred in predictions.model1 %}
                                        <tr>
                                            <td>{{ pred.target_date|date:"m月d日" }}</td>
                                            <td>{{ pred.pm25_pred|floatformat:1 }}</td>
                                            <td>{{ pred.pm10_pred|floatformat:1 }}</td>
                                            <td>{{ pred.no2_pred|floatformat:1 }}</td>
                                            <td>{{ pred.so2_pred|floatformat:1 }}</td>
                                            <td>{{ pred.o3_pred|floatformat:1 }}</td>
                                            <td>{{ pred.co_pred|floatformat:1 }}</td>
                                            <td>{{ pred.overall_aqi_pred }}</td>
                                            <td>{{ pred.main_pollutant_pred }}</td>
                                            <td><span class="badge bg-{{ pred.aqi_level_pred|lower }}">{{ pred.aqi_level_pred }}</span></td>
                                        </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        <!-- 模型二内容 -->
                        <div class="tab-pane fade" id="model2-content" role="tabpanel" aria-labelledby="model2-tab">
                            <!-- 加载状态覆盖层 -->
                            <div class="loading-overlay" id="forecastChartLoader2">
                                <div class="spinner"></div>
                            </div>

                            <!-- 预测图表 -->
                            <div class="chart-container" style="height: 400px;">
                                <canvas id="forecastChart2"></canvas>
                            </div>

                            <!-- 预测数据表格 -->
                            <div class="table-responsive mt-4">
                                <table class="table table-striped">
                                    <thead>
                                        <tr>
                                            <th>预测日期</th>
                                            <th>PM2.5 预测值 <span class="info-icon" data-pollutant="pm25">i</span></th>
                                            <th>PM10 预测值 <span class="info-icon" data-pollutant="pm10">i</span></th>
                                            <th>NO₂ 预测值 <span class="info-icon" data-pollutant="no2">i</span></th>
                                            <th>SO₂ 预测值 <span class="info-icon" data-pollutant="so2">i</span></th>
                                            <th>O₃ 预测值 <span class="info-icon" data-pollutant="o3">i</span></th>
                                            <th>CO 预测值 <span class="info-icon" data-pollutant="co">i</span></th>
                                            <th>综合AQI</th>
                                            <th>主要污染物</th>
                                            <th>污染等级</th>
                                        </tr>
                                    </thead>
                                    <tbody id="forecastTableBody2">
                                        <!-- 后端渲染模型二数据 -->
                                        {% for pred in predictions.model2 %}
                                        <tr>
                                            <td>{{ pred.target_date|date:"m月d日" }}</td>
                                            <td>{{ pred.pm25_pred|floatformat:1 }}</td>
                                            <td>{{ pred.pm10_pred|floatformat:1 }}</td>
                                            <td>{{ pred.no2_pred|floatformat:1 }}</td>
                                            <td>{{ pred.so2_pred|floatformat:1 }}</td>
                                            <td>{{ pred.o3_pred|floatformat:1 }}</td>
                                            <td>{{ pred.co_pred|floatformat:1 }}</td>
                                            <td>{{ pred.overall_aqi_pred }}</td>
                                            <td>{{ pred.main_pollutant_pred }}</td>
                                            <td><span class="badge bg-{{ pred.aqi_level_pred|lower }}">{{ pred.aqi_level_pred }}</span></td>
                                        </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        <!-- 模型三内容 -->
                        <div class="tab-pane fade" id="model3-content" role="tabpanel" aria-labelledby="model3-tab">
                            <!-- 加载状态覆盖层 -->
                            <div class="loading-overlay" id="forecastChartLoader3">
                                <div class="spinner"></div>
                            </div>

                            <!-- 预测图表 -->
                            <div class="chart-container" style="height: 400px;">
                                <canvas id="forecastChart3"></canvas>
                            </div>

                            <!-- 预测数据表格 -->
                            <div class="table-responsive mt-4">
                                <table class="table table-striped">
                                    <thead>
                                        <tr>
                                            <th>预测日期</th>
                                            <th>PM2.5 预测值 <span class="info-icon" data-pollutant="pm25">i</span></th>
                                            <th>PM10 预测值 <span class="info-icon" data-pollutant="pm10">i</span></th>
                                            <th>NO₂ 预测值 <span class="info-icon" data-pollutant="no2">i</span></th>
                                            <th>SO₂ 预测值 <span class="info-icon" data-pollutant="so2">i</span></th>
                                            <th>O₃ 预测值 <span class="info-icon" data-pollutant="o3">i</span></th>
                                            <th>CO 预测值 <span class="info-icon" data-pollutant="co">i</span></th>
                                            <th>综合AQI</th>
                                            <th>主要污染物</th>
                                            <th>污染等级</th>
                                        </tr>
                                    </thead>
                                    <tbody id="forecastTableBody3">
                                        <!-- 后端渲染模型三数据 -->
                                        {% for pred in predictions.model3 %}
                                        <tr>
                                            <td>{{ pred.target_date|date:"m月d日" }}</td>
                                            <td>{{ pred.pm25_pred|floatformat:1 }}</td>
                                            <td>{{ pred.pm10_pred|floatformat:1 }}</td>
                                            <td>{{ pred.no2_pred|floatformat:1 }}</td>
                                            <td>{{ pred.so2_pred|floatformat:1 }}</td>
                                            <td>{{ pred.o3_pred|floatformat:1 }}</td>
                                            <td>{{ pred.co_pred|floatformat:1 }}</td>
                                            <td>{{ pred.overall_aqi_pred }}</td>
                                            <td>{{ pred.main_pollutant_pred }}</td>
                                            <td><span class="badge bg-{{ pred.aqi_level_pred|lower }}">{{ pred.aqi_level_pred }}</span></td>
                                        </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        <!-- 模型四内容 -->
                        <div class="tab-pane fade" id="model4-content" role="tabpanel" aria-labelledby="model4-tab">
                            <!-- 加载状态覆盖层 -->
                            <div class="loading-overlay" id="forecastChartLoader4">
                                <div class="spinner"></div>
                            </div>

                            <!-- 预测图表 -->
                            <div class="chart-container" style="height: 400px;">
                                <canvas id="forecastChart4"></canvas>
                            </div>

                            <!-- 预测数据表格 -->
                            <div class="table-responsive mt-4">
                                <table class="table table-striped">
                                    <thead>
                                        <tr>
                                            <th>预测日期</th>
                                            <th>PM2.5 预测值 <span class="info-icon" data-pollutant="pm25">i</span></th>
                                            <th>PM10 预测值 <span class="info-icon" data-pollutant="pm10">i</span></th>
                                            <th>NO₂ 预测值 <span class="info-icon" data-pollutant="no2">i</span></th>
                                            <th>SO₂ 预测值 <span class="info-icon" data-pollutant="so2">i</span></th>
                                            <th>O₃ 预测值 <span class="info-icon" data-pollutant="o3">i</span></th>
                                            <th>CO 预测值 <span class="info-icon" data-pollutant="co">i</span></th>
                                            <th>综合AQI</th>
                                            <th>主要污染物</th>
                                            <th>污染等级</th>
                                        </tr>
                                    </thead>
                                    <tbody id="forecastTableBody4">
                                        <!-- 数据将通过JavaScript动态填充 -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_css %}
<style>
    /* 信息图标样式 */
    .info-icon {
        display: inline-block;
        width: 16px;
        height: 16px;
        border-radius: 50%;
        background-color: #0d6efd;
        color: white;
        text-align: center;
        line-height: 16px;
        font-size: 12px;
        cursor: pointer;
        margin-left: 5px;
        position: relative;
    }

    /* 弹窗样式 */
    .pollutant-tooltip {
        position: absolute;
        z-index: 100;
        width: 250px;
        padding: 10px;
        background-color: #fff;
        border: 1px solid #ddd;
        border-radius: 4px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.15);
        font-size: 14px;
        display: none;
    }

    .pollutant-tooltip h6 {
        margin: 0 0 5px 0;
        color: #0d6efd;
        font-size: 15px;
    }

    .pollutant-tooltip p {
        margin: 5px 0;
        font-size: 13px;
    }

    /* 表格宽度与响应式调整 */
    .table-responsive {
        overflow-x: auto; /* 确保小屏幕可横向滚动 */
        min-width: 100%; /* 表格容器最小宽度 */
    }

    .table td, .table th {
        white-space: nowrap; /* 防止内容换行 */
        padding: 8px 12px; /* 优化内边距 */
        text-align: center; /* 内容居中对齐 */
        overflow: hidden;
        text-overflow: ellipsis;
    }

    /* 调整表格最小宽度，确保标题不换行 */
    .table-striped {
        min-width: 1000px; /* 根据列数调整，确保所有标题在一行 */
    }

    /* 日期列宽度固定 */
    .table th:first-child,
    .table td:first-child {
        width: 100px; /* 日期列固定宽度 */
    }

    /* 污染等级列宽度固定 */
    .table th:last-child,
    .table td:last-child {
        width: 120px; /* 污染等级列固定宽度 */
    }

    /* 小屏幕适配 */
    @media (max-width: 768px) {
        .table-responsive {
            margin: 0 -15px; /* 边缘延伸，增加可视区域 */
            padding: 0 15px;
        }
    }

    /* 加载状态样式 */
    .loading-overlay {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(255, 255, 255, 0.7);
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 10;
        display: none;
    }

    .loading-overlay.active {
        display: flex;
    }

    .spinner {
        width: 40px;
        height: 40px;
        border: 4px solid rgba(0, 123, 255, 0.2);
        border-radius: 50%;
        border-top-color: #0d6efd;
        animation: spin 1s ease-in-out infinite;
    }

    @keyframes spin {
        to { transform: rotate(360deg); }
    }

    .chart-container {
        position: relative;
        margin: auto;
        height: 400px;
    }
</style>
{% endblock %}

{% block extra_js %}
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.8/dist/chart.umd.min.js"></script>
<script>
// 页面加载完成后初始化
document.addEventListener('DOMContentLoaded', function() {
    // 初始化四个模型的预测图表
    initForecastChart('1');
    initForecastChart('2');
    initForecastChart('3');
    initForecastChart('4');

    // 加载四个模型的预测数据
    loadForecastData('1');
    loadForecastData('2');
    loadForecastData('3');
    loadForecastData('4');
});

// 初始化预测图表 - 接收模型编号参数
function initForecastChart(modelId) {
    const ctx = document.getElementById(`forecastChart${modelId}`).getContext('2d');
    // 模拟未来7天日期
    const dates = Array.from({length: 7}, (_, i) => {
        const d = new Date();
        d.setDate(d.getDate() + i + 1);
        return `${d.getMonth() + 1}月${d.getDate()}日`;
    });

    // 创建空图表，稍后通过loadForecastData填充数据
    window[`forecastChart${modelId}`] = new Chart(ctx, {
        type: 'line',
        data: {
            labels: dates,
            datasets: [
                {
                    label: 'PM2.5',
                    data: Array(7).fill(0),
                    borderColor: 'rgba(255, 99, 132, 1)',
                    backgroundColor: 'rgba(255, 99, 132, 0.1)',
                    tension: 0.3
                },
                {
                    label: 'O₃',
                    data: Array(7).fill(0),
                    borderColor: 'rgba(54, 162, 235, 1)',
                    backgroundColor: 'rgba(54, 162, 235, 0.1)',
                    tension: 0.3
                },
                {
                    label: 'PM10',
                    data: Array(7).fill(0),
                    borderColor: 'rgba(255, 206, 86, 1)',
                    backgroundColor: 'rgba(255, 206, 86, 0.1)',
                    tension: 0.3
                },
                {
                    label: 'SO₂',
                    data: Array(7).fill(0),
                    borderColor: 'rgba(75, 192, 192, 1)',
                    backgroundColor: 'rgba(75, 192, 192, 0.1)',
                    tension: 0.3,
                    fill: true
                },
                {
                    label: 'NO₂',
                    data: Array(7).fill(0),
                    borderColor: 'rgba(153, 102, 255, 1)',
                    backgroundColor: 'rgba(153, 102, 255, 0.1)',
                    tension: 0.3,
                    fill: true
                },
                {
                    label: 'CO',
                    data: Array(7).fill(0),
                    borderColor: 'rgba(255, 159, 64, 1)',
                    backgroundColor: 'rgba(255, 159, 64, 0.1)',
                    tension: 0.3,
                    fill: true
                },
                // AQI趋势线
                {
                    label: 'AQI指数',
                    data: Array(7).fill(0),
                    borderColor: 'rgba(255, 0, 0, 1)',
                    backgroundColor: 'rgba(255, 0, 0, 0.05)',
                    tension: 0.3,
                    fill: true,
                    borderWidth: 3,
                    pointRadius: 5,
                    pointHoverRadius: 7
                }
            ]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: {
                y: {
                    beginAtZero: true,
                    title: {
                        display: true,
                        text: '浓度 (μg/m³，CO为mg/m³,AQI为指数)'
                    }
                }
            }
        }
    });

    // 隐藏加载状态
    document.getElementById(`forecastChartLoader${modelId}`).classList.remove('active');
}

// 计算综合AQI、主要污染物和污染等级
function calculateOverallAqi(concs) {
    // AQI计算标准（根据国家标准简化）
    const aqiBreakpoints = {
        pm25: [
            [0, 35, 0, 50],    // 优
            [35.1, 75, 51, 100], // 良
            [75.1, 115, 101, 150], // 轻度污染
            [115.1, 150, 151, 200], // 中度污染
            [150.1, 250, 201, 300], // 重度污染
            [250.1, 500, 301, 500]  // 严重污染
        ],
        pm10: [
            [0, 50, 0, 50],
            [51, 150, 51, 100],
            [151, 250, 101, 150],
            [251, 350, 151, 200],
            [351, 420, 201, 300],
            [421, 600, 301, 500]
        ],
        no2: [
            [0, 40, 0, 50],
            [41, 80, 51, 100],
            [81, 180, 101, 150],
            [181, 280, 151, 200],
            [281, 565, 201, 300],
            [566, 940, 301, 500]
        ],
        so2: [
            [0, 50, 0, 50],
            [51, 150, 51, 100],
            [151, 475, 101, 150],
            [476, 800, 151, 200],
            [801, 1600, 201, 300],
            [1601, 2620, 301, 500]
        ],
        o3: [
            [0, 100, 0, 50],
            [101, 160, 51, 100],
            [161, 215, 101, 150],
            [216, 265, 151, 200],
            [266, 800, 201, 300],
            [801, 1000, 301, 500]
        ],
        co: [
            [0, 2, 0, 50],
            [2.1, 4, 51, 100],
            [4.1, 14, 101, 150],
            [14.1, 24, 151, 200],
            [24.1, 36, 201, 300],
            [36.1, 60, 301, 500]
        ]
    };

    // 计算各污染物的AQI
    let aqiValues = {};
    for (let pollutant in concs) {
        let concentration = parseFloat(concs[pollutant]);
        let breakpoints = aqiBreakpoints[pollutant];

        // 找到对应的浓度区间
        for (let i = 0; i < breakpoints.length; i++) {
            let [lowConc, highConc, lowAqi, highAqi] = breakpoints[i];
            if (concentration <= highConc) {
                // 计算该污染物的AQI
                let aqi = ((highAqi - lowAqi) / (highConc - lowConc)) * (concentration - lowConc) + lowAqi;
                aqiValues[pollutant] = Math.round(aqi);
                break;
            }
        }
    }

    // 确定综合AQI和主要污染物
    let overallAqi = Math.max(...Object.values(aqiValues));
    let mainPollutant = Object.keys(aqiValues).find(p => aqiValues[p] === overallAqi);

    // 确定污染等级
    let level, levelClass;
    if (overallAqi <= 50) {
        level = "优";
        levelClass = "success";
    } else if (overallAqi <= 100) {
        level = "良";
        levelClass = "info";
    } else if (overallAqi <= 150) {
        level = "轻度污染";
        levelClass = "warning";
    } else if (overallAqi <= 200) {
        level = "中度污染";
        levelClass = "primary";
    } else if (overallAqi <= 300) {
        level = "重度污染";
        levelClass = "danger";
    } else {
        level = "严重污染";
        levelClass = "dark";
    }

    return [overallAqi, mainPollutant, level, levelClass];
}

// 加载预测数据 - 接收模型编号参数
function loadForecastData(modelId) {
    const tableBody = document.getElementById(`forecastTableBody${modelId}`);
    
    tableBody.innerHTML = '';
    // 为不同模型设置不同的随机数据偏移量
    const offset = modelId === '1' ? 0 : 10;

    // 模拟7天预测数据
    const forecastData = Array.from({length: 7}, (_, i) => {
        const d = new Date();
        d.setDate(d.getDate() + i + 1);
        const concs = {
            pm25: Math.floor(Math.random() * 80) + 20 + offset,
            pm10: Math.floor(Math.random() * 100) + 30 + offset,
            no2: Math.floor(Math.random() * 50) + 10 + offset,
            so2: Math.floor(Math.random() * 30) + 5 + offset,
            o3: Math.floor(Math.random() * 100) + 25 + offset,
            co: parseFloat((Math.random() * 3 + 0.8 + offset * 0.1).toFixed(1))
        };
        const [overallAqi, mainPollutant, level, levelClass] = calculateOverallAqi(concs);
        return {
            date: d,
            pm25: concs.pm25,
            pm10: concs.pm10,
            no2: concs.no2,
            so2: concs.so2,
            o3: concs.o3,
            co: concs.co,
            overallAqi,
            mainPollutant,
            level,
            levelClass
        };
    });

    // 提取图表所需的数据数组
    const pm25Data = forecastData.map(item => item.pm25);
    const pm10Data = forecastData.map(item => item.pm10);
    const no2Data = forecastData.map(item => item.no2);
    const so2Data = forecastData.map(item => item.so2);
    const o3Data = forecastData.map(item => item.o3);
    const coData = forecastData.map(item => item.co);
    const aqiData = forecastData.map(item => item.overallAqi);

    // 更新图表数据
    const chart = window[`forecastChart${modelId}`];
    if (chart) {
        chart.data.datasets[0].data = pm25Data;
        chart.data.datasets[1].data = o3Data;
        chart.data.datasets[2].data = pm10Data;
        chart.data.datasets[3].data = so2Data;
        chart.data.datasets[4].data = no2Data;
        chart.data.datasets[5].data = coData;
        chart.data.datasets[6].data = aqiData;
        chart.update();
    }

    // 填充表格
    forecastData.forEach(item => {
        const row = document.createElement('tr');
        const dateStr = `${item.date.getMonth() + 1}月${item.date.getDate()}日`;

        row.innerHTML = `
            <td>${dateStr}</td>
            <td>${item.pm25}</td>
            <td>${item.pm10}</td>
            <td>${item.no2}</td>
            <td>${item.so2}</td>
            <td>${item.o3}</td>
            <td>${item.co}</td>
            <td>${item.overallAqi}</td>
            <td>${item.mainPollutant}</td>
            <td><span class="badge bg-${item.levelClass}">${item.level}</span></td>
        `;
        tableBody.appendChild(row);
    });
}

// 污染物详情配置
const pollutantConfig = {
    pm25: {
        name: 'PM2.5',
        description: '细颗粒物，直径小于等于2.5微米',
        healthImpact: '可进入肺部深处，引发呼吸系统疾病',
        standard: '国家二级标准：年均35μg/m³，日均75μg/m³'
    },
    pm10: {
        name: 'PM10',
        description: '可吸入颗粒物，直径小于等于10微米',
        healthImpact: '可沉积在呼吸道，引起不适',
        standard: '国家二级标准：年均70μg/m³，日均150μg/m³'
    },
    no2: {
        name: '二氧化氮',
        description: '主要来自机动车尾气',
        healthImpact: '刺激呼吸道，降低肺功能',
        standard: '国家二级标准：年均40μg/m³，日均80μg/m³'
    },
    so2: {
        name: '二氧化硫',
        description: '主要来自燃烧过程',
        healthImpact: '引起呼吸道疾病，加重哮喘',
        standard: '国家二级标准：年均60μg/m³，日均150μg/m³'
    },
    o3: {
        name: '臭氧',
        description: '光化学烟雾的主要成分',
        healthImpact: '刺激眼睛和呼吸道，影响肺部功能',
        standard: '国家二级标准：8小时平均160μg/m³'
    },
    co: {
        name: '一氧化碳',
        description: '无色无味的有毒气体',
        healthImpact: '影响氧气运输，导致缺氧',
        standard: '国家二级标准：日均4mg/m³'
    }
};

// 为信息图标添加交互
document.querySelectorAll('.info-icon').forEach(icon => {
    // 创建提示框
    const tooltip = document.createElement('div');
    tooltip.className = 'pollutant-tooltip';
    document.body.appendChild(tooltip);

    // 鼠标悬停显示提示
    icon.addEventListener('mouseenter', function(e) {
        const pollutant = this.getAttribute('data-pollutant');
        const info = pollutantConfig[pollutant];

        tooltip.innerHTML = `
            <h6>${info.name}</h6>
            <p>${info.description}</p>
            <p><strong>健康影响：</strong>${info.healthImpact}</p>
            <p><strong>国家标准：</strong>${info.standard}</p>
        `;

        // 定位提示框
        const rect = this.getBoundingClientRect();
        tooltip.style.top = `${rect.bottom + window.scrollY + 5}px`;
        tooltip.style.left = `${rect.left + window.scrollX - 120}px`;
        tooltip.style.display = 'block';
    });

    // 鼠标离开隐藏提示
    icon.addEventListener('mouseleave', function() {
        tooltip.style.display = 'none';
    });
});
</script>
{% endblock %}